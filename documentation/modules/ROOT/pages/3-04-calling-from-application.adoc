= 2.4 Calling the API from an application

include::_attributes.adoc[]

Now that you have a working API that serves predictions, you can call it from an application.

You deploy an application to the same project (that contains the data model) and refer to the application by using its internal service name.

//need to provide an additional resource for info on using a route which exposes the service externally outside the cluster. 

. Verify the REST service's name and port.
+
If you followed the naming instructions in the `2_save_model.ipynb` file, as directed in xref:3-01-save-model.adoc[3.4 Preparing the model for deployment], the REST service URL is `http://object-detection-rest:8080`. 

.. In the Data Science dashboard, select *Topology*. 

.. Open your deployment's detail screen. Check the service *name* and *port*.
+
The internal URL should be `http://<service-name>:<service-port>`
+
image::s2i/topology-rest-service.png[alt text, 700]

. Create the front end application.
+
You have two options for creating the front end application, depending on how quickly you want to do it:

* If you have time, you can build the application from source code, like you did for the REST API. 

* If you want to do it quickly, you can run the application from a pre-built container.


Using a pre-built container::

You can create the front end application by using a pre-built container from a public container registry.
+
.. In the Data Science dashboard, select *+Add* and then click the *Container images* tile:
+
image::s2i/from-container-image.png[alt text, 800]

.. For *Image name*, enter the location of the container:
+
[.lines_space]
[.console-input]
[source,text]
----
quay.io/agroom/object-detection-app
----
+
image::s2i/deploy-image.png[alt text, 800]
+
If you've entered the correct repository it is marked as *validated*.

.. Optionally, you can set the runtime icon from something other than OpenShift, in the example screen *nodejs* was chosen.
//is this the deploy-image.png ?

Using Git source code::

You can build the the front end application by building it from `Node.js` source code.

.. Select *+Add* and then click *Import from Git*.
+
image::s2i/from-git.png[alt text, 800]

.. For *Git Repo URL* enter:
+
[.lines_space]
[.console-input]
[source,text]
----
https://github.com/rh-aiservices-bu/object-detection-app.git
----
+
If you entered the correct repository, the `Node.js` builder image is selected because the front end application is written in `Node.js`.
+
image::s2i/git-repo-app.png[alt text, 800]


. Configure the runtime aspects of the application.

.. By default, the new deployment is added to the existing application `object-detection` that you created previously. You can leave that as is.  
.. Optionally, you can change the *Name* from `object-detection-app-git` to  `object-detection-app`.
+
image::s2i/general-app.png[alt text, 700]

. For the route, accept the default *secure https* route.

. Configure the deployment environment variables
+
The application needs to know where to send its images for predictions. Previously, you confirmed the service URL of the `object-detection-rest` deployment.  You can use that value and add `/predictions`.  This URL instructs the front end application where to send the images by setting the `OBJECT_DETECTION_URL` variable to `http://<service-name>:<service-port/predictions`.

.. Open the *Deployment*  options to set an environment variable:
+
image::s2i/create-app-deployment.png[alt text, 700]

.. Under *Environment variables (runtime only)*, create the following Name / Value pair:
+
Name:
+
[.lines_space]
[.console-input]
[source,text]
----
OBJECT_DETECTION_URL
----
+
Value:
+
[.lines_space]
[.console-input]
[source,text]
----
http://object-detection-rest:8080/predictions
----
+
NOTE: If you named the REST service `object-detection-rest`, this value should be `http://object-detection-rest:8080/predictions`.  If not, use the value.
//use the value fo rwhat?
+
image::s2i/create-app-env-var.png[alt text, 800]

. Scroll down and then click *Create*:
+
image::s2i/create-button.png[alt text]

.Verification

You can see a new application has been created and is currently building. 

. Wait for the build to complete and for the pods to deploy.
+
image::s2i/topology-app.png[alt text, 800]

. After the application is deployed to OpenShift, click the Route URL to launch the application.

. Try it from your laptop or from a phone with a camera.
+
NOTE: Optionally, if you don't want to type that long Route URL into your phone's browser, you can convert the URL into a QR code by using a QR code generator, for example: https://www.qr-code-generator.com[QR code generator].

. Return here when you're ready to continue with the workshop.

.Next steps

xref:3-01-running-the-model-offline.adoc[offline scoring].